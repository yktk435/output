
流れはこんな感じです。

1. Apache2のインストトール
2. PHPのインストール
3. MariaDBのインストール
4. WordPressのインストール

1〜3まではインストールしてあると思うので軽くインストrーうしているかを確認するだけにしておき、WordPressのインストールから本格的に始めていきます。

# インストール済みパッケージを確認する

Apache2、PHP、MariaDBがちゃんとインストールされているか確認するコマンドは以下です。

```bash
$ sudo apt list --installed | grep パッケージ名
```

# WordPressのインストール
[こちら](https://ja.wordpress.org/support/article/how-to-install-wordpress/)の公式ページを見ながら進めていきます。
## インストール要件
- PHP 7.3 以上
- MySQL 5.6 以上または MariaDB 10.1 以上

インストールして言いるMariaDBのバージョンは
```bash
#$ mysql --version
mysql  Ver 15.1 Distrib 10.0.28-MariaDB, for debian-linux-gnueabihf (armv7l) using readline 5.2
```
```bash
#$ dpkg -l | grep mariadb
ii  libmariadb3:armhf                 1:10.3.27-0+deb10u1                 armhf        MariaDB database client library
ii  mariadb-client-10.0               10.0.28-2+b1                        armhf        MariaDB database client binaries
ii  mariadb-client-core-10.0          10.0.28-2+b1                        armhf        MariaDB database core client binaries
ii  mariadb-common                    1:10.3.27-0+deb10u1                 all          MariaDB common metapackage
ii  mariadb-server-10.0               10.0.28-2+b1                        armhf        MariaDB database server binaries
ii  mariadb-server-core-10.0          10.0.28-2+b1                        armhf        MariaDB database core server files
```
10.0.28で要件の10.1に満たないのでアップデートします

## リポジトリ追加

ラズパイのデビアンのバージョンは
```bash
#$ cat /etc/debian_version
10.7
```
それに応じて[こちら](https://downloads.mariadb.org/mariadb/repositories/)から選択します

以下の手順でリポジトリが追加されます。

```bash
sudo apt-get install software-properties-common dirmngr
sudo apt-key adv --fetch-keys 'https://mariadb.org/mariadb_release_signing_key.asc'
sudo add-apt-repository 'deb [arch=amd64,arm64,ppc64el] https://mirrors.bkns.vn/mariadb/repo/10.5/debian buster main'
```


## 既存MariaDBを停止しておく
```bash
sudo systemctl stop mysql.service
```
## MarinaDBをアップデート
```bash
sudo apt update
sudo apt install mariadb-server
```
### 進歩状況が途中で止まった
進歩状況が92%で止まり動かなくなったので一旦`Ctrol+Z`で停止

もう一回実行すると
```
Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?
```
とエラー

`(/var/lib/dpkg/lock-frontend)を取得できないけど他で使ってないか？`といっているようで一旦掃除

### 対策
```bash
sudo rm /var/lib/dpkg/lock
sudo rm /var/lib/dpkg/lock-frontend
```
```bash
#sudo apt install mariadb-server
E: dpkg は中断されました。問題を修正するには 'sudo dpkg --configure -a' を手動で実行する必要があります。
```
というわけで手動でインストール
```bash
#mysql --version
mysql  Ver 15.1 Distrib 10.3.27-MariaDB, for debian-linux-gnueabihf (armv8l) using readline 5.2
```
これでDBのWordPressの要件をクリアできました。
## WordPressインストール手順
### ダウンロード・解凍
```bash
#インストールしたい場所に移動
cd /var/www/html/

#WordPress最新版をダウンロード
sudo wget https://wordpress.org/latest.tar.gz

#解凍
sudo tar -xzvf latest.tar.gz
#同じディレクトリ内に「wordpress」ディレクトリが作成される

#パッケージを消去
sudo rm latest.tar.gz
```
### WordPress用のDBユーザを作成
```bash
#mysqlにログイン
sudo mysql

#データベース作成
create database wordpress;

#ユーザ作成
CREATE USER 'wpuser'@'localhost' IDENTIFIED BY 'wpuser';

#DBに入って作成したユーザに権限付与
GRANT ALL on wordpress.* TO 'wpuser'@'localhost' IDENTIFIED BY 'wpuser';

#DBからぬけて作成したユーザでログインし直し
mysql -u wpuser -p

#ログインできれば成功
```
# WordPress初期セットアップ
`http://(ラズパイのIPアドレス)/wordpress/wp-admin`
にアクセス

![WordPress初期設定](https://user-images.githubusercontent.com/43082614/106355975-161cae80-633f-11eb-983e-2e340cc0fd2a.png)


*進める前にDB関係の情報がほしい
その情報をwpーconfig．phpを作るのに使うけど、作られ得なくても自分で作ることがでけいるから安心して*

ざっくりこんなこといってます。
とりあえずlet's goをクリック
![スクリーンショット 2021-01-30 21 14 30](https://user-images.githubusercontent.com/43082614/106356084-284b1c80-6340-11eb-8b61-1c00b9799b29.png)

さっき作ったDB関連の情報を入力します
![スクリーンショット 2021-01-30 21 21 33](https://user-images.githubusercontent.com/43082614/106356201-22097000-6341-11eb-8f83-ac79545ea933.png)

*wp-config.php を書き込めなかったら手動でつくって、終わったらボタン押して*

Apacheユーザが権限を持っていなかったのでファイルを自動的に作れなかったので手動でwp-config.phpを作成します。

書き込む内容は表示されているのでコピペして`wp-config.php`を作るだけです。

ファイルができたらボタンを押します。
![スクリーンショット 2021-01-30 21 23 43](https://user-images.githubusercontent.com/43082614/106356222-701e7380-6341-11eb-9cba-49bb00cdee53.png)

インストールまであと一歩です
サイトタイトルとかありますが、これらの情報は後でいつでも書き換えられます。

とりあえずタイトルもユーザー名も適当に入力していおきます。

入力したらボタンをクリックしてWordPressをインストール

![スクリーンショット 2021-01-30 21 29 42](https://user-images.githubusercontent.com/43082614/106356338-4580ea80-6342-11eb-8308-8fae9226360c.png)

インストール完了

# 次回は日本語化
次回は日本語化の手順を書いていきます。

# 参考
[【２０２０年】ラズパイにWordPressをインストールしてブログを立ち上げる手順を分かりやすく解説。
](https://mugendennou.net/linux/raspi/raspiapplication/raspiwordpressinstall/)
